<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lernspiel-Sammlung - Karteikasten Edition</title>
    <style>
        /* --- BASIS & ANTI-SCROLL --- */
        body, html { 
            margin: 0; padding: 0; 
            height: 100dvh; width: 100vw;
            font-family: 'Comic Sans MS', cursive, sans-serif; 
            overflow: hidden; 
            background: linear-gradient(135deg, #7ed957, #5d8aff);
        }

        /* --- LAYOUT SYSTEM --- */
        .game-wrapper {
            display: none;
            width: 100%;
            height: 100dvh;
            padding: 15px;
            box-sizing: border-box;
            gap: 20px;
            justify-content: center;
            align-items: center;
        }

        /* QUERFORMAT (Desktop / iPad Quer) */
        @media (orientation: landscape) {
            .game-wrapper { flex-direction: row; }
            .box-sidebar { 
                width: 20vw; 
                height: 80%; 
                flex-direction: column-reverse; /* Box 4 nach oben */
            }
            .task-container { width: 70vw; height: 85dvh; }
        }

        /* HOCHFORMAT (Handy / iPad Hoch) */
        @media (orientation: portrait) {
            .game-wrapper { flex-direction: column; justify-content: flex-start; padding-top: 60px; }
            .box-sidebar { 
                width: 100%; 
                height: auto; 
                flex-direction: row; /* Box 1-4 nebeneinander */
                order: -1; /* Sidebar nach oben */
            }
            .task-container { width: 100%; flex-grow: 1; margin-bottom: 20px; }
        }

        /* --- DIE INSEL (SIDEBAR) --- */
        .box-sidebar {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.5);
            display: flex;
            gap: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            z-index: 10;
        }

        /* --- DER AUFGABEN-RAHMEN --- */
        .task-container {
            background-color: white;
            border-radius: 35px;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            position: relative;
            max-height: 90dvh;
        }

        /* --- ELEMENTE IM SPIEL --- */
        .game-title-header {
            font-size: clamp(16px, 4vh, 22px);
            color: #1e3a8a;
            margin-bottom: 10px;
            font-weight: bold;
            border-bottom: 2px dashed #eee;
            padding-bottom: 8px;
        }

        .box-indicator {
            background: white; border: 2px solid #ccc; border-radius: 12px;
            padding: 5px; flex: 1; display: flex; flex-direction: column; justify-content: center;
        }
        .goal-box { border-color: #ffd700; background: #fffdf0; box-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .box-label { font-size: 9px; color: #666; text-transform: uppercase; }
        .box-count { font-size: 18px; font-weight: bold; }

        .word-display { font-size: clamp(35px, 10vh, 60px); font-weight: bold; margin: auto 0; padding: 20px 0; }
        
        /* Buttons */
        .btn-group { display: flex; gap: 15px; justify-content: center; margin-top: auto; }
        .action-btn { 
            padding: 15px 30px; font-size: 20px; font-weight: bold; 
            border: none; border-radius: 20px; cursor: pointer; color: white;
            transition: transform 0.1s;
        }
        .action-btn:active { transform: scale(0.95); }

        /* Farbschemata */
        .g1-border { border: 6px solid #7ed957; box-shadow: 0 10px 0px #aad922; }
        .g2-border { border: 6px solid #5d8aff; box-shadow: 0 10px 0px #adc4ff; }
        .g3-border { border: 6px solid #ff9800; box-shadow: 0 10px 0px #ffb74d; }

        /* Men√º & Teacher */
        #main-menu { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100dvh; }
        .menu-card { background: white; padding: 30px; border-radius: 30px; width: 80%; max-width: 400px; text-align: center; }
        .menu-btn { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: none; color: white; font-weight: bold; font-size: 18px; cursor: pointer; }
        
        .back-btn { position: absolute; top: 10px; left: 10px; padding: 8px 15px; background: #333; color: white; border-radius: 10px; border: none; z-index: 100; cursor: pointer; }
        .hidden { display: none !important; }

        #teacher-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .teacher-card { background: white; padding: 20px; border-radius: 20px; width: 90%; max-width: 500px; max-height: 80dvh; overflow-y: auto; }
        
        input#g2-user-input { 
            font-size: clamp(30px, 8vh, 50px); width: 120px; border: 3px dashed #5d8aff; 
            border-radius: 15px; text-align: center; font-family: inherit;
        }
    </style>
</head>
<body>

    <div id="main-menu">
        <div class="menu-card">
            <h1 style="margin-top:0">Lernspiele</h1>
            <button class="menu-btn" style="background:#4CAF50" onclick="startGame(1)">Rechtschreib-Held</button>
            <button class="menu-btn" style="background:#5d8aff" onclick="startGame(2)">Rechtschreib-Profi</button>
            <button class="menu-btn" style="background:#ff9800" onclick="startGame(3)">Schreib-Profi</button>
            <button class="menu-btn" style="background:#9c27b0" onclick="toggleTeacher(true)">‚öôÔ∏è Lehrer</button>
        </div>
    </div>

    <div id="game-wrapper" class="game-wrapper">
        <button class="back-btn" onclick="goToMenu()">üè† Men√º</button>
        
        <div class="box-sidebar" id="box-status-bar">
            </div>

        <div id="active-task-container" class="task-container">
            <div id="game-title" class="game-title-header">Titel</div>
            <div id="game-content">
                <div id="game-progress" style="color: #666; font-size: 14px;">Wort 1 von 10</div>
                
                <div id="ui-g1" class="hidden">
                    <div id="g1-word" class="word-display">Wort</div>
                    <div class="btn-group">
                        <button class="action-btn" style="background:#4CAF50" onclick="Game1.handleAnswer(true)">RICHTIG</button>
                        <button class="action-btn" style="background:#F44336" onclick="Game1.handleAnswer(false)">FALSCH</button>
                    </div>
                </div>

                <div id="ui-g2" class="hidden">
                    <div id="g2-area" class="word-display" style="display: flex; justify-content: center; align-items: center;">
                        <span id="g2-pre"></span>
                        <input type="text" id="g2-user-input" autocomplete="off" autofocus>
                        <span id="g2-post"></span>
                    </div>
                    <button class="action-btn" style="background:#5d8aff; width:100%" onclick="Game2.checkInput()">Pr√ºfen!</button>
                </div>

                <div id="ui-g3" class="hidden">
                    <button class="action-btn" style="background:#ff9800; width:100%; margin-bottom:10px;" onclick="Game3.speakWord()">üîä H√∂ren</button>
                    <div id="g3-word" class="word-display">???</div>
                    <button id="g3-show-btn" class="action-btn" style="background:#2196f3; width:100%" onclick="Game3.showWord()">Vergleichen</button>
                    <div id="g3-choice" class="btn-group hidden">
                        <button class="action-btn" style="background:#4CAF50" onclick="Game3.handleResult(true)">‚úÖ Stimmt</button>
                        <button class="action-btn" style="background:#F44336" onclick="Game3.handleResult(false)">‚ùå Falsch</button>
                    </div>
                </div>

                <div id="game-feedback" style="font-size: 24px; font-weight: bold; margin-top: 15px; min-height: 30px;"></div>
            </div>

            <div id="result-screen" class="hidden">
                <h1 id="result-text">Super!</h1>
                <button class="action-btn" style="background:#333" onclick="restartCurrentGame()">Nochmal</button>
            </div>
        </div>
    </div>

    <div id="teacher-overlay">
        <div class="teacher-card">
            <h2>Einstellungen</h2>
            <div style="margin-bottom:15px">
                <b>Held:</b> <input type="text" id="t-title-1" placeholder="Titel" style="width:100%"><br>
                <textarea id="t-input-1" style="width:100%; height:40px">Katze/r, Katse/f</textarea>
            </div>
            <div style="margin-bottom:15px">
                <b>Profi 1:</b> <input type="text" id="t-title-2" placeholder="Titel" style="width:100%"><br>
                <textarea id="t-input-2" style="width:100%; height:40px">Ka/tz/e, Ja/ck/e</textarea>
            </div>
            <div style="margin-bottom:15px">
                <b>Profi 2:</b> <input type="text" id="t-title-3" placeholder="Titel" style="width:100%"><br>
                <textarea id="t-input-3" style="width:100%; height:40px">Katze, Jacke</textarea>
            </div>
            <button class="menu-btn" style="background:#4CAF50" onclick="saveConfig()">Speichern & Schlie√üen</button>
            <button class="menu-btn" style="background:#2196f3" onclick="copyLink()">üîó Link kopieren</button>
        </div>
    </div>

    <script>
        let currentActiveGame = 1;

        const BoxSystem = {
            progress: JSON.parse(localStorage.getItem('box_progress') || '{}'),
            save() { localStorage.setItem('box_progress', JSON.stringify(this.progress)); this.updateUI(); },
            updateWord(word, correct) {
                let b = this.progress[word] || 1;
                this.progress[word] = correct ? Math.min(b + 1, 4) : 1;
                this.save();
            },
            updateUI() {
                const container = document.getElementById('box-status-bar');
                const raw = document.getElementById(`t-input-${currentActiveGame}`).value.split(',').map(s=>s.trim()).filter(s=>s!=="");
                let counts = {1:0, 2:0, 3:0, 4:0};
                raw.forEach(w => counts[this.progress[w] || 1]++);
                container.innerHTML = `
                    <div class="box-indicator"><span class="box-label">Box 1</span><span class="box-count">${counts[1]}</span></div>
                    <div class="box-indicator"><span class="box-label">Box 2</span><span class="box-count">${counts[2]}</span></div>
                    <div class="box-indicator"><span class="box-label">Box 3</span><span class="box-count">${counts[3]}</span></div>
                    <div class="box-indicator goal-box"><span class="box-label">Ziel</span><span class="box-count">${counts[4]}</span></div>
                `;
            },
            getSelection(words) {
                return words.sort(() => 0.5 - Math.random()).slice(0, 10);
            }
        };

        const Game1 = {
            pool: [], index: 0, score: 0, current: null,
            init() {
                const words = document.getElementById('t-input-1').value.split(',').map(s=>s.trim()).filter(s=>s!=="");
                this.pool = BoxSystem.getSelection(words);
                this.index = 0; this.score = 0; this.next();
            },
            next() {
                if(this.index >= 10 || this.index >= this.pool.length) return showFinal();
                let entry = this.pool[this.index++];
                let p = entry.split('/');
                this.current = { word: p[0], isRight: p[1].toLowerCase()==='r', raw: entry };
                document.getElementById('g1-word').innerText = this.current.word;
                document.getElementById('game-progress').innerText = `Frage ${this.index} von 10`;
                document.getElementById('game-feedback').innerText = "";
            },
            handleAnswer(choice) {
                const win = (choice === this.current.isRight);
                if(win) this.score++;
                BoxSystem.updateWord(this.current.raw, win);
                document.getElementById('game-feedback').innerText = win ? "‚úÖ Super!" : "‚ùå Ups!";
                setTimeout(() => this.next(), 800);
            }
        };

        const Game2 = {
            pool: [], index: 0, score: 0, current: null,
            init() {
                const words = document.getElementById('t-input-2').value.split(',').map(s=>s.trim()).filter(s=>s!=="");
                this.pool = BoxSystem.getSelection(words);
                this.index = 0; this.score = 0; this.next();
            },
            next() {
                if(this.index >= 10 || this.index >= this.pool.length) return showFinal();
                let entry = this.pool[this.index++];
                let p = entry.split('/');
                this.current = { pre: p[0], sol: p[1], post: p[2], raw: entry };
                document.getElementById('g2-pre').innerText = this.current.pre;
                document.getElementById('g2-post').innerText = this.current.post;
                const inp = document.getElementById('g2-user-input');
                inp.value = ""; inp.disabled = false;
                document.getElementById('game-progress').innerText = `Frage ${this.index} von 10`;
                document.getElementById('game-feedback').innerText = "";
                setTimeout(() => inp.focus(), 50);
            },
            checkInput() {
                const val = document.getElementById('g2-user-input').value.trim().toLowerCase();
                const win = (val === this.current.sol.toLowerCase());
                if(win) this.score++;
                BoxSystem.updateWord(this.current.raw, win);
                document.getElementById('g2-user-input').disabled = true;
                document.getElementById('game-feedback').innerText = win ? "‚úÖ Richtig!" : `‚ùå L√∂sung: ${this.current.sol}`;
                setTimeout(() => this.next(), 1200);
            }
        };

        const Game3 = {
            pool: [], index: 0, score: 0, current: "",
            init() {
                const words = document.getElementById('t-input-3').value.split(',').map(s=>s.trim()).filter(s=>s!=="");
                this.pool = BoxSystem.getSelection(words);
                this.index = 0; this.score = 0; this.next();
            },
            next() {
                if(this.index >= 10 || this.index >= this.pool.length) return showFinal();
                this.current = this.pool[this.index++];
                document.getElementById('g3-word').innerText = "???";
                document.getElementById('g3-show-btn').classList.remove('hidden');
                document.getElementById('g3-choice').classList.add('hidden');
                document.getElementById('game-progress').innerText = `Wort ${this.index} von 10`;
                document.getElementById('game-feedback').innerText = "";
                setTimeout(() => this.speakWord(), 500);
            },
            speakWord() {
                const msg = new SpeechSynthesisUtterance(this.current);
                msg.lang = 'de-DE';
                window.speechSynthesis.speak(msg);
            },
            showWord() {
                document.getElementById('g3-word').innerText = this.current;
                document.getElementById('g3-show-btn').classList.add('hidden');
                document.getElementById('g3-choice').classList.remove('hidden');
            },
            handleResult(win) {
                if(win) this.score++;
                BoxSystem.updateWord(this.current, win);
                this.next();
            }
        };

        function startGame(num) {
            currentActiveGame = num;
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('game-wrapper').style.display = 'flex';
            document.getElementById('game-content').classList.remove('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            
            document.getElementById('ui-g1').classList.toggle('hidden', num !== 1);
            document.getElementById('ui-g2').classList.toggle('hidden', num !== 2);
            document.getElementById('ui-g3').classList.toggle('hidden', num !== 3);
            
            const cont = document.getElementById('active-task-container');
            cont.className = 'task-container g' + num + '-border';
            
            document.getElementById('game-title').innerText = document.getElementById('t-title-' + num).value;
            
            BoxSystem.updateUI();
            if(num === 1) Game1.init();
            if(num === 2) Game2.init();
            if(num === 3) Game3.init();
        }

        function showFinal() {
            document.getElementById('game-content').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            let s = currentActiveGame === 1 ? Game1.score : (currentActiveGame === 2 ? Game2.score : Game3.score);
            document.getElementById('result-text').innerText = `Fertig! ${s} von 10 Punkten!`;
        }

        function restartCurrentGame() { startGame(currentActiveGame); }
        function goToMenu() { location.reload(); }
        function toggleTeacher(s) { document.getElementById('teacher-overlay').style.display = s ? 'flex' : 'none'; }

        function saveConfig() {
            for(let i=1; i<=3; i++) {
                localStorage.setItem('g'+i+'_data', document.getElementById('t-input-'+i).value);
                localStorage.setItem('g'+i+'_title', document.getElementById('t-title-'+i).value);
            }
            toggleTeacher(false);
        }

        function copyLink() {
            const data = {
                v: 2,
                t: [document.getElementById('t-title-1').value, document.getElementById('t-title-2').value, document.getElementById('t-title-3').value],
                d: [document.getElementById('t-input-1').value, document.getElementById('t-input-2').value, document.getElementById('t-input-3').value]
            };
            const url = window.location.origin + window.location.pathname + "?config=" + btoa(unescape(encodeURIComponent(JSON.stringify(data))));
            navigator.clipboard.writeText(url).then(() => alert("Link kopiert!"));
        }

        window.onload = () => {
            for(let i=1; i<=3; i++) {
                if(localStorage.getItem('g'+i+'_data')) document.getElementById('t-input-'+i).value = localStorage.getItem('g'+i+'_data');
                if(localStorage.getItem('g'+i+'_title')) document.getElementById('t-title-'+i).value = localStorage.getItem('g'+i+'_title');
            }
            const params = new URLSearchParams(window.location.search);
            if(params.get('config')) {
                const conf = JSON.parse(decodeURIComponent(escape(atob(params.get('config')))));
                conf.t.forEach((t, i) => document.getElementById('t-title-'+(i+1)).value = t);
                conf.d.forEach((d, i) => document.getElementById('t-input-'+(i+1)).value = d);
                saveConfig();
            }
        };

        // Enter-Taste Support f√ºr Spiel 2
        document.getElementById('g2-user-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') Game2.checkInput();
        });
    </script>
</body>
</html>
